# 调研结果

## 权限管理方案

在调研中，发现使用 `Hidden` 权限可以阻止所有用户查看仓库，但超级管理员和 `refs/*` owner 角色仍然可以继续克隆项目。因此，决定针对封存项目进行备份 owner 权限的设计。具体方案如下：

- 单独将 owner 权限备份到 `back` 文件中。
- 恢复时，通过传入 `reload` 和 `repo_path` 参数一键恢复，同时删除 `back` 文件中的权限备份。
- 每次备份和恢复都记录日志文件，包括时间戳和参数打印，以实现操作的自动化封存和解封。

## 封存逻辑设计

### 入参
- `repo_path`: 仓库路径

### 封存逻辑
封装 `seal_up_repo` 函数：

1. 通过 `permission` 接口带参数 `repo_path` 判断是否存在 owner 角色。
   - 不存在：调用 `state` 接口直接将仓库状态置为 `Hidden`。
   - 存在：备份 owner 角色（写入到 `back` 文件），去掉权限，然后将仓库状态置为 `Hidden`。

## 恢复逻辑设计

### 入参
- `reload`: 恢复标志
- `repo_path`: 仓库路径

封装逻辑函数 `reload_permission` 参数为两位，`reload` 和 `repo_path`：

- 函数通过 `repo_path` 参数查看 `back` 文件是否存在 owner 权限。
  - 不存在：调用 `state` 接口将仓库状态置为 `Active` 恢复即可。
  - 存在：读取 `back` 文件，使用 `repo_path` 参数获取 owner 权限数据，调用恢复接口恢复权限，最后调用 `state` 接口将仓库状态置为 `Active` 恢复即可。

以上设计方案可以实现自动化的封存和解封操作，保障权限管理的灵活性和安全性。
